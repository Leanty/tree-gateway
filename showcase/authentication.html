<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Free API Gateway node JS Open source">
    <meta name="author" content="Tree Gateway">
    
    <title>Tree Gateway - Authentication</title>
    
    <script type="text/javascript" src="./webcomponents-lite.js" ></script>
    <script type="text/javascript" src="./source-code-example.js" ></script>
</head>

<body id="page-top" class="index">
    <h1>Tree Gateway - Authentication</h1>
    
    <!-- <p>In all authentication examples, we will map a route to the test API <a href="http://httpbin.org">http://httpbin.org</a>.
    This site contains a set of test endpoints, like <a href="http://httpbin.org/get">http://httpbin.org/get</a>.
    </p> -->

    <p>We are assuming in these examples, that our test gateway will be running at 'http://gateway.address.com'.</p>

    <h2>JWT</h2>

    <leanty-source-code-example id="code">
            <leanty-title>JWT Example</leanty-title>
            <leanty-source label="Yaml File" language="yaml">
---
name: MyJWTAuthenticatedAPI
version: 1.0.0
path: jwt/
proxy:
    target:
        host: http://httpbin.org
authentication:
    strategy:
        name: jwt
        options:
            extractFrom:
                authHeader: Bearer
                queryParam: jwt
            secretOrKey: secret
            </leanty-source>
            <leanty-description>
                <p>This sample will make tree gateway to check authentication using JWT tokens before proxy the request 
                    to the mapped API (http://httpbin.org). </p>
                <p>The token will be verified using the key 'secret' and you will be able to provide the token through one of those methods:
                    <ul>
                        <li>the header 'Authorization' with the 'Bearer' scheme. Eg. <span style="background-color: black; color: white; font-size: 13px;">curl -H "Authorization: Bearer [TOKEN]" http://gateway.address.com/jwt/get</span></li>
                        <li>the query parameter 'jwt'. Eg. <span style="background-color: black; color: white; font-size: 13px;">curl http://gateway.address.com/jwt/get?jwt=[token]</span></li>
                    </ul>
                </p>
            </leanty-description>
        </leanty-source-code-example>

        <h2>Basic</h2>

        <leanty-source-code-example id="code">
            <leanty-title>Basic Authentication</leanty-title>
            <leanty-source label="Yaml File" language="yaml">
---
name: MyBasicAuthenticatedAPI
version: 1.0.0
path: basic/
proxy:
    target:
        host: http://httpbin.org
authentication:
    strategy:
        name: basic
        options:
            verify:
                name: verifyMyUser        
            </leanty-source>
            <leanty-source label="verifyMyUser middleware" language="javascript">
"use strict";

const User = require('./my-user-service');

module.exports = function (userid, password, done){
    User.findOne({ username: userid }, function (err, user) {
      if (err) { return done(err); }
      if (!user) { return done(null, false); }
      if (!user.verifyPassword(password)) { return done(null, false); }
      return done(null, user);
    });
};
            </leanty-source>
                                
            <leanty-description>
                <p>This sample will make tree gateway to check authentication using http basic scheme before proxy the request 
                    to the mapped API (http://httpbin.org). </p>
                <p>The verifyMyUser middleware is used to verify the provided username and password.
                </p>
            </leanty-description>
        </leanty-source-code-example>

        <h2>Authenticate Groups os URIs</h2>

        <leanty-source-code-example id="code">
            <leanty-title>Group Example</leanty-title>
            <leanty-source label="Yaml File" language="yaml">
---
name: MyGroupAuthenticatedAPI
version: 1.0.0
path: group/
group:
- id: secureGroup
  description: Secured endpoints
  member:
  - path:
    - "!/public/**/*"
proxy:
    target:
        host: http://httpbin.org
authentication:
    strategy:
        name: jwt
        options:
            extractFrom:
                authHeader: Bearer
                queryParam: jwt
            secretOrKey: secret
    group: secureGroup
            </leanty-source>
            <leanty-description>
                <p>This sample wil configure the same authentication as we show in the JWT example, but 
                    applying it only to certain group of URIs.</p>
                <p>All API requests will be authenticated, except by those which starts with '/public' in its path.</p>
                <p>Example of URI that will not be authenticated:
                <span style="background-color: black; color: white; font-size: 13px;">curl http://gateway.address.com/group/public/get</span>.
                </p>
            </leanty-description>
        </leanty-source-code-example>
            
</body>

</html>