{"version":3,"sources":["../../src/lib/authentication/auth.ts"],"names":[],"mappings":"AAAA,YAAY,CAAC;AAGb,IAAY,KAAK,WAAM,YAAY,CAAC,CAAA;AACpC,IAAY,QAAQ,WAAM,MAAM,CAAC,CAAA;AACjC,IAAY,IAAI,WAAM,UAAU,CAAC,CAAA;AAGjC,IAAM,kBAAkB,GAAG;IACvB,KAAK,EAAE,OAAO,CAAC,kBAAkB,CAAC;IAClC,OAAO,EAAE,OAAO,CAAC,oBAAoB,CAAC;IACtC,OAAO,EAAE,OAAO,CAAC,oBAAoB,CAAC;CACzC,CAAA;AAED;IAGI,iBAAY,OAAgB;QACxB,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC;IAC3B,CAAC;IAED,gCAAc,GAAd,UAAe,MAAc,EAAE,IAAY,EAAE,cAAoC;QAAjF,iBAsBC;QArBG,KAAK,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC,OAAO,CAAC,UAAA,GAAG;YAClC,IAAI,CAAC;gBACD,IAAI,UAAU,GAAG,cAAc,CAAC,GAAG,CAAC,CAAC;gBACrC,EAAE,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,kBAAkB,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC;oBACrC,IAAI,QAAQ,GAAG,kBAAkB,CAAC,GAAG,CAAC,CAAC;oBACvC,QAAQ,CAAC,MAAM,EAAE,UAAU,EAAE,KAAI,CAAC,OAAO,CAAC,CAAC;gBAC/C,CAAC;gBACD,IAAI,CAAC,CAAC;oBACF,IAAI,CAAC,GAAG,QAAQ,CAAC,IAAI,CAAC,KAAI,CAAC,OAAO,CAAC,cAAc,EAAE,gBAAgB,EAAE,YAAY,EAAG,GAAG,CAAC,CAAC;oBACzF,IAAI,QAAQ,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC;oBAC1B,QAAQ,CAAC,MAAM,EAAE,UAAU,CAAC,CAAC;gBACjC,CAAC;gBACD,KAAI,CAAC,OAAO,CAAC,MAAM,CAAC,GAAG,CAAC,IAAI,EAAE,IAAI,CAAC,YAAY,CAAC,MAAM,EAAE,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC,CAAC,CAAC;gBAC7E,EAAE,CAAC,CAAC,KAAI,CAAC,OAAO,CAAC,MAAM,CAAC,cAAc,CAAC,CAAC,CAAC;oBACrC,KAAI,CAAC,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,uDAAuD,EAAE,GAAG,EAAE,IAAI,CAAC,CAAC;gBAClG,CAAC;YACL,CACA;YAAA,KAAK,CAAA,CAAC,CAAC,CAAC,CAAC,CAAC;gBACN,KAAI,CAAC,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,8DAA8D,EAAE,GAAG,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;YAC5G,CAAC;QACL,CAAC,CAAC,CAAC;IACP,CAAC;IACL,cAAC;AAAD,CA9BA,AA8BC,IAAA;AA9BY,eAAO,UA8BnB,CAAA","file":"auth.js","sourcesContent":["\"use strict\";\n\nimport {AuthenticationConfig} from \"../config/authentication\";\nimport * as Utils from \"underscore\";\nimport * as pathUtil from \"path\"; \nimport * as auth from \"passport\"; \nimport {Gateway} from \"../gateway\";\n\nconst providedStrategies = {\n    'jwt': require('./strategies/jwt'),\n    'basic': require('./strategies/basic'),\n    'local': require('./strategies/local')\n} \n\nexport class ApiAuth {\n    private gateway: Gateway;\n\n    constructor(gateway: Gateway) {\n        this.gateway = gateway;\n    }\n\n    authentication(apiKey: string, path: string, authentication: AuthenticationConfig) {\n        Utils.keys(authentication).forEach(key=>{\n            try {\n                let authConfig = authentication[key];\n                if (Utils.has(providedStrategies, key)) {\n                    let strategy = providedStrategies[key];\n                    strategy(apiKey, authConfig, this.gateway);\n                }\n                else {\n                    let p = pathUtil.join(this.gateway.middlewarePath, 'authentication', 'strategies' , key);                \n                    let strategy = require(p);\n                    strategy(apiKey, authConfig);\n                }\n                this.gateway.server.use(path, auth.authenticate(apiKey, { session: false }));\n                if (this.gateway.logger.isDebugEnabled) {\n                    this.gateway.logger.debug(\"Authentication Strategy [%s] configured for path [%s]\", key, path);\n                }\n            }\n            catch(e) {\n                this.gateway.logger.error(\"Error configuring Authentication Strategy [%s] for path [%s]\", key, path, e);\n            }\n        });\n    }\n}\n"]}