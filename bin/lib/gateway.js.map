{"version":3,"sources":["../../src/lib/gateway.ts"],"names":[],"mappings":"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","file":"gateway.js","sourcesContent":["\"use strict\";\n\nimport * as http from \"http\";\nimport * as logger from \"morgan\";\nimport * as compression from \"compression\";\nimport * as express from \"express\";\nimport * as fs from \"fs-extra\";\nimport * as StringUtils from \"underscore.string\";\nimport {ApiConfig} from \"./config/api\";\nimport {GatewayConfig} from \"./config/gateway\";\nimport {ApiProxy} from \"./proxy/proxy\";\nimport * as Utils from \"./proxy/utils\";\nimport {ApiRateLimit} from \"./throttling/throttling\";\nimport {ApiAuth} from \"./authentication/auth\";\nimport {Set, StringMap} from \"./es5-compat\";\nimport {Logger} from \"./logger\";\nimport * as redis from \"ioredis\";\nimport * as dbConfig from \"./redis\";\nimport * as path from \"path\";\n\nlet defaults = require('defaults');\n\nexport class Gateway {\n    private app: express.Application;\n    private adminApp: express.Application;\n    private apiProxy: ApiProxy;\n    private apiRateLimit: ApiRateLimit;\n    private apiAuth: ApiAuth;\n    private apis: StringMap<ApiConfig>;\n    private _config: GatewayConfig;\n    private _logger: Logger;\n    private _redisClient: redis.Redis;\n    private configFile: string;\n    private apiServer: http.Server;\n    private adminServer: http.Server;\n\n    constructor(gatewayConfigFile: string) {\n        this.configFile = gatewayConfigFile;\n    }    \n    \n    get server(): express.Application {\n        return this.app;\n    }\n\n    get logger(): Logger {\n        return this._logger;\n    }\n\n    get config(): GatewayConfig {\n        return this._config;\n    }\n\n    get redisClient(): redis.Redis {\n        return this._redisClient;\n    }\n\n    get apiPath(): string {\n        return this.config.apiPath;\n    }\n\n    get middlewarePath(): string {\n        return this.config.middlewarePath;\n    }\n\n    start(ready?: ()=>void) {\n        this.initialize(this.configFile, ()=>{\n            this.apiServer = this.app.listen(this.config.listenPort, ()=>{\n                this.logger.info('Gateway listenning on port %d', this.config.listenPort);\n                if (ready) {\n                    ready();\n                }\n            });\n        });  \n    }\n\n    startAdmin(ready?: ()=>void) {\n        if (this.adminApp) {\n            this.adminServer = this.adminApp.listen(this.config.adminPort, ()=>{\n                this.logger.info('Gateway Admin Server listenning on port %d', this.config.adminPort);\n                if (ready) {\n                    ready();\n                }\n            });\n        }\n        else {\n            console.error(\"You must start the Tree-Gateway before.\");\n        }\n    }\n\n    stop() {\n        if (this.apiServer) {\n            this.apiServer.close();\n            this.apiServer = null;\n        }\n    }\n\n    stopAdmin() {\n        if (this.adminServer) {\n            this.adminServer.close();\n            this.adminServer = null;\n        }\n    }\n\n    private loadApis(ready?: () => void) {\n        this.apis = new StringMap<ApiConfig>();\n        let path = this.apiPath;\n        fs.readdir(path, (err, files) => {\n            if (err) {\n                this._logger.error(\"Error reading directory: \"+err);\n            }\n            else {\n                path = ((StringUtils.endsWith(path, '/'))?path:path+'/');\n                const length = files.length;\n                files.forEach((fileName, index) =>{\n                    if (StringUtils.endsWith(fileName, '.json')) {\n                        fs.readJson(path+fileName, (error, apiConfig: ApiConfig)=>{\n                            if (error) {\n                                this._logger.error(\"Error reading directory: \"+error);\n                            }\n                            else {\n                                this.loadApi(apiConfig, (length -1 === index)?ready: null);\n                            }\n                        });\n                    }\n                });\n            }\n        });\n    }\n\n    private loadApi(api: ApiConfig, ready?: () => void) {\n        if (this._logger.isInfoEnabled()) {\n            this._logger.info(\"Configuring API [%s] on path: %s\", api.name, api.proxy.path);\n        }\n        let apiKey: string = this.getApiKey(api);\n        this.apis.set(apiKey, api);\n        api.proxy.path = Utils.normalizePath(api.proxy.path);\n        \n        if (api.throttling) {\n            if (this._logger.isDebugEnabled()) {\n                this._logger.debug(\"Configuring API Rate Limits\");\n            }\n            this.apiRateLimit.throttling(api.proxy.path, api.throttling);\n        }\n        if (api.authentication) {\n            if (this._logger.isDebugEnabled()) {\n                this._logger.debug(\"Configuring API Authentication\");\n            }\n            this.apiAuth.authentication(apiKey, api.proxy.path, api.authentication);\n        }\n        if (this._logger.isDebugEnabled()) {\n            this._logger.debug(\"Configuring API Proxy\");\n        }\n        this.apiProxy.proxy(api);\n        \n        if (ready) {\n            ready();\n        }\n    }\n\n    private initialize(configFileName: string, ready?: ()=>void) {\n        if (StringUtils.startsWith(configFileName, '.')) {\n            configFileName = path.join(process.cwd(), configFileName);                \n        }\n        \n        fs.readJson(configFileName, (error, gatewayConfig: GatewayConfig)=>{\n            if (error) {\n                console.error(\"Error reading tree-gateway.json config file: \"+error);\n            }\n            else {\n                this.app = express();\n                this._config = defaults(gatewayConfig, {\n                    rootPath : path.dirname(configFileName),\n                });\n                if (StringUtils.startsWith(this._config.rootPath, '.')) {\n                    this._config.rootPath = path.join(path.dirname(configFileName), this._config.rootPath);\n                }\n\n                this._config = defaults(this._config, {\n                    apiPath : path.join(this._config.rootPath, 'apis'),\n                    middlewarePath : path.join(this._config.rootPath, 'middleware')\n                });\n\n                if (StringUtils.startsWith(this._config.apiPath, '.')) {\n                    this._config.apiPath = path.join(this._config.rootPath, this._config.apiPath);                \n                }\n                if (StringUtils.startsWith(this._config.middlewarePath, '.')) {\n                    this._config.middlewarePath = path.join(this._config.rootPath, this._config.middlewarePath);                \n                }\n                this._logger = new Logger(this.config.logger, this);\n                if (this.config.database) {\n                    this._redisClient = dbConfig.initializeRedis(this.config.database);\n                }\n                this.apiProxy = new ApiProxy(this);\n                this.apiRateLimit = new ApiRateLimit(this);\n                this.apiAuth = new ApiAuth(this);\n\n                this.configureServer(ready);\n                this.configureAdminServer();\n            }\n        });\n    }\n\n    private configureServer(ready: ()=>void) {\n        this.app.disable('x-powered-by'); \n        this.app.use(compression());\n        if (this.config.underProxy) {\n            this.app.enable('trust proxy'); \n        }\n        if (this.app.get('env') == 'production') {\n            // const accessLogStream = fs.createWriteStream(path.join(Parameters.rootDir, 'logs/access_errors.log'),{flags: 'a'});\n            // gateway.server.use(logger('common', {\n            //   skip: function(req: express.Request, res: express.Response) { \n            //       return res.statusCode < 400 \n            //   }, \n            //   stream: accessLogStream }));\n        } \n        else {\n            this.app.use(logger('dev'));\n        }\n        this.loadApis(ready);\n    }\n\n    private configureAdminServer() {\n        this.adminApp = express();\n        this.adminApp.disable('x-powered-by'); \n        this.adminApp.use(compression());\n        this.adminApp.use(logger('dev'));\n\n        // Server.buildServices(adminServer, APIService);\n        // adminServer.listen(gateway.config.adminPort, ()=>{\n        //     // winston.info('Gateway Admin API listenning on port %d', Parameters.adminPort);\n        // });\n\n    }\n\n    private getApiKey(api: ApiConfig) {\n        return api.name + (api.version? '_'+api.version: '_default');\n    }\n}\n/*TODO: \n- Create a file for Gateway configurations:\n  - Global interceptors / Filters / Throttling\n- Create a global interceptor to add a 'Via' header pointing to Tree-Gateway\n- Expose an Admin port\n- Manage API versions\n- Fix the log (winston is not logging on log file, but just on consoles)\n- Create a clsuter program, to initialize the app in cluster\n*/"]}