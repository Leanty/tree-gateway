{"version":3,"sources":["proxy/filter.js","../../src/lib/proxy/filter.ts"],"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","__metadata","k","v","metadata","Utils","require","typescript_ioc_1","settings_1","path","ProxyFilter","prototype","buildFilters","proxy","filterChain","Array","hasMethodFilter","push","buildMethodFilter","hasPathFilter","buildPathFilter","hasCustomFilter","buildCustomFilter","_this","func","filter","forEach","index","p","join","settings","middlewarePath","name","f","eval","allowPath","normalizePath","denyPath","body","allowMethod","method","toUpperCase","denyMethod","Function","Inject","Settings","AutoWired","exports"],"mappings":"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","file":"filter.js","sourcesContent":["\"use strict\";\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __metadata = (this && this.__metadata) || function (k, v) {\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\nvar Utils = require(\"./utils\");\nvar typescript_ioc_1 = require(\"typescript-ioc\");\nvar settings_1 = require(\"../settings\");\nvar path = require(\"path\");\nvar ProxyFilter = (function () {\n    function ProxyFilter() {\n    }\n    ProxyFilter.prototype.buildFilters = function (proxy) {\n        var filterChain = new Array();\n        if (this.hasMethodFilter(proxy)) {\n            filterChain.push(this.buildMethodFilter(proxy));\n        }\n        if (this.hasPathFilter(proxy)) {\n            filterChain.push(this.buildPathFilter(proxy));\n        }\n        if (this.hasCustomFilter(proxy)) {\n            filterChain.push(this.buildCustomFilter(proxy));\n        }\n        return filterChain;\n    };\n    ProxyFilter.prototype.buildCustomFilter = function (proxy) {\n        var _this = this;\n        var func = new Array();\n        func.push(\"function(req, res){\");\n        func.push(\"var accepted = (\");\n        proxy.filter.forEach(function (filter, index) {\n            if (index > 0) {\n                func.push(\"||\");\n            }\n            var p = path.join(_this.settings.middlewarePath, 'filter', filter.name);\n            func.push(\"require('\" + p + \"')(req, res)\");\n        });\n        func.push(\");\");\n        func.push(\"return accepted;\");\n        func.push(\"}\");\n        var f;\n        eval('f = ' + func.join(''));\n        return f;\n    };\n    ProxyFilter.prototype.buildPathFilter = function (proxy) {\n        var func = new Array();\n        func.push(\"function(req, res){\");\n        func.push(\"var pathToRegexp = require('path-to-regexp');\");\n        func.push(\"var StringUtils = require('underscore.string');\");\n        func.push(\"var accepted = true;\");\n        func.push(\"var targetPath = req.path;\");\n        if (proxy.target.allowPath && proxy.target.allowPath.length > 0) {\n            func.push(\"accepted = (\");\n            proxy.target.allowPath.forEach(function (path, index) {\n                if (index > 0) {\n                    func.push(\"||\");\n                }\n                func.push(\"(pathToRegexp('\" + Utils.normalizePath(path) + \"').test(targetPath))\");\n            });\n            func.push(\");\");\n        }\n        if (proxy.target.denyPath && proxy.target.denyPath.length > 0) {\n            func.push(\"accepted = accepted && (\");\n            proxy.target.denyPath.forEach(function (path, index) {\n                if (index > 0) {\n                    func.push(\"&&\");\n                }\n                func.push(\"!(pathToRegexp('\" + Utils.normalizePath(path) + \"').test(targetPath))\");\n            });\n            func.push(\");\");\n        }\n        func.push(\"return accepted;\");\n        func.push(\"}\");\n        var f;\n        eval('f = ' + func.join(''));\n        return f;\n    };\n    ProxyFilter.prototype.buildMethodFilter = function (proxy) {\n        var body = new Array();\n        body.push(\"var accepted = true;\");\n        if (proxy.target.allowMethod && proxy.target.allowMethod.length > 0) {\n            body.push(\"accepted = (\");\n            proxy.target.allowMethod.forEach(function (method, index) {\n                if (index > 0) {\n                    body.push(\"||\");\n                }\n                body.push(\"(req.method === '\" + method.toUpperCase() + \"')\");\n            });\n            body.push(\");\");\n        }\n        if (proxy.target.denyMethod && proxy.target.denyMethod.length > 0) {\n            body.push(\"accepted = accepted && (\");\n            proxy.target.denyMethod.forEach(function (method, index) {\n                if (index > 0) {\n                    body.push(\"&&\");\n                }\n                body.push(\"(req.method !== '\" + method.toUpperCase() + \"')\");\n            });\n            body.push(\");\");\n        }\n        body.push(\"if (!accepted){ res.status(405);}\");\n        body.push(\"return accepted;\");\n        return Function(\"req\", \"res\", body.join(''));\n    };\n    ProxyFilter.prototype.hasCustomFilter = function (proxy) {\n        return (proxy.filter && proxy.filter.length > 0);\n    };\n    ProxyFilter.prototype.hasPathFilter = function (proxy) {\n        return (proxy.target.allowPath && proxy.target.allowPath.length > 0)\n            || (proxy.target.denyPath && proxy.target.denyPath.length > 0);\n    };\n    ProxyFilter.prototype.hasMethodFilter = function (proxy) {\n        return (proxy.target.allowMethod && proxy.target.allowMethod.length > 0)\n            || (proxy.target.denyMethod && proxy.target.denyMethod.length > 0);\n    };\n    __decorate([\n        typescript_ioc_1.Inject, \n        __metadata('design:type', settings_1.Settings)\n    ], ProxyFilter.prototype, \"settings\", void 0);\n    ProxyFilter = __decorate([\n        typescript_ioc_1.AutoWired, \n        __metadata('design:paramtypes', [])\n    ], ProxyFilter);\n    return ProxyFilter;\n}());\nexports.ProxyFilter = ProxyFilter;\n","\"use strict\";\n\nimport * as StringUtils from \"underscore.string\";\nimport * as config from \"../config\";\nimport * as Utils from \"./utils\";\nimport {AutoWired, Inject} from \"typescript-ioc\";\nimport {Settings} from \"../settings\";\nimport * as path from \"path\"; \n \n@AutoWired\nexport class ProxyFilter {\n    @Inject\n    private settings: Settings;\n    buildFilters(proxy: config.Proxy) {\n        let filterChain = new Array<Function>();\n        if (this.hasMethodFilter(proxy)) {\n            filterChain.push(this.buildMethodFilter(proxy));\n        }\n        if (this.hasPathFilter(proxy)) {\n          filterChain.push(this.buildPathFilter(proxy));\n        }\n        if (this.hasCustomFilter(proxy)) {\n          filterChain.push(this.buildCustomFilter(proxy));\n        }\n        return filterChain;\n    }\n\n    private buildCustomFilter(proxy: config.Proxy) {\n        let func = new Array<string>();\n        func.push(\"function(req, res){\");\n        func.push(\"var accepted = (\");\n        proxy.filter.forEach((filter, index)=>{\n            if (index > 0) {\n                func.push(\"||\");                \n            }\n            let p = path.join(this.settings.middlewarePath, 'filter' ,filter.name);                \n            func.push(\"require('\"+p+\"')(req, res)\");\n        });\n        func.push(\");\");\n        func.push(\"return accepted;\");\n        func.push(\"}\");\n        let f;\n        eval('f = '+func.join(''))\n        return f;\n    }\n\n    private buildPathFilter(proxy: config.Proxy) {\n        let func = new Array<string>();\n        func.push(\"function(req, res){\");\n        func.push(\"var pathToRegexp = require('path-to-regexp');\");\n        func.push(\"var StringUtils = require('underscore.string');\");\n        func.push(\"var accepted = true;\");\n        func.push(\"var targetPath = req.path;\");\n        if (proxy.target.allowPath && proxy.target.allowPath.length > 0) {\n            func.push(\"accepted = (\");\n            proxy.target.allowPath.forEach((path, index)=>{\n                if (index > 0) {\n                    func.push(\"||\");                \n                }                \n                func.push(\"(pathToRegexp('\"+Utils.normalizePath(path)+\"').test(targetPath))\");\n            });\n            func.push(\");\");\n        }\n        if (proxy.target.denyPath && proxy.target.denyPath.length > 0) {\n            func.push(\"accepted = accepted && (\");\n            proxy.target.denyPath.forEach((path, index)=>{\n                if (index > 0) {\n                    func.push(\"&&\");                \n                }\n                func.push(\"!(pathToRegexp('\"+Utils.normalizePath(path)+\"').test(targetPath))\");\n            });\n            func.push(\");\");\n        }\n        func.push(\"return accepted;\");\n        func.push(\"}\");\n        let f;\n        eval('f = '+func.join(''))\n        return f;\n    }\n\n    private buildMethodFilter(proxy: config.Proxy) {\n        let body = new Array<string>();\n        body.push(\"var accepted = true;\");\n        if (proxy.target.allowMethod && proxy.target.allowMethod.length > 0) {\n            body.push(\"accepted = (\");\n            proxy.target.allowMethod.forEach((method, index)=>{\n                if (index > 0) {\n                    body.push(\"||\");                \n                }\n                body.push(\"(req.method === '\"+method.toUpperCase()+\"')\")\n            });\n            body.push(\");\");\n        }\n        if (proxy.target.denyMethod && proxy.target.denyMethod.length > 0) {\n            body.push(\"accepted = accepted && (\");\n            proxy.target.denyMethod.forEach((method, index) => {\n                if (index > 0) {\n                    body.push(\"&&\");                \n                }\n                body.push(\"(req.method !== '\"+method.toUpperCase()+\"')\")\n            });\n            body.push(\");\");\n        }\n        body.push(\"if (!accepted){ res.status(405);}\");\n        body.push(\"return accepted;\");\n        return Function(\"req\", \"res\", body.join(''));\n    }\n\n    private hasCustomFilter(proxy: config.Proxy) {\n        return (proxy.filter && proxy.filter.length > 0);\n    }\n\n    private hasPathFilter(proxy: config.Proxy) {\n        return (proxy.target.allowPath && proxy.target.allowPath.length > 0)\n            || (proxy.target.denyPath && proxy.target.denyPath.length > 0);\n    }\n\n    private hasMethodFilter(proxy: config.Proxy) {\n        return (proxy.target.allowMethod && proxy.target.allowMethod.length > 0)\n            || (proxy.target.denyMethod && proxy.target.denyMethod.length > 0);\n    }\n}  "]}