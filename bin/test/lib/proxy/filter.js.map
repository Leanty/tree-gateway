{"version":3,"sources":["proxy/filter.js","../../src/lib/proxy/filter.ts"],"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","__metadata","k","v","metadata","Utils","require","typescript_ioc_1","settings_1","path","pathToRegexp","ProxyFilter","prototype","buildFilters","proxy","filterChain","Array","allow","push","buildAllowFilter","deny","buildDenyFilter","hasCustomFilter","buildCustomFilter","_this","func","filter","forEach","index","appliesTo","normalizePath","p","join","settings","middlewarePath","name","f","eval","method","toUpperCase","Inject","Settings","AutoWired","exports"],"mappings":"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","file":"filter.js","sourcesContent":["\"use strict\";\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __metadata = (this && this.__metadata) || function (k, v) {\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\nvar Utils = require(\"./utils\");\nvar typescript_ioc_1 = require(\"typescript-ioc\");\nvar settings_1 = require(\"../settings\");\nvar path = require(\"path\");\nvar pathToRegexp = require('path-to-regexp');\nvar ProxyFilter = (function () {\n    function ProxyFilter() {\n    }\n    ProxyFilter.prototype.buildFilters = function (proxy) {\n        var filterChain = new Array();\n        if (proxy.target.allow) {\n            filterChain.push(this.buildAllowFilter(proxy.target.allow));\n        }\n        if (proxy.target.deny) {\n            filterChain.push(this.buildDenyFilter(proxy.target.deny));\n        }\n        if (this.hasCustomFilter(proxy)) {\n            filterChain.push(this.buildCustomFilter(proxy));\n        }\n        return filterChain;\n    };\n    ProxyFilter.prototype.buildCustomFilter = function (proxy) {\n        var _this = this;\n        var func = new Array();\n        func.push(\"function(req, res){\");\n        func.push(\"var accepted = true;\");\n        func.push(\"accepted = (\");\n        proxy.filter.forEach(function (filter, index) {\n            if (index > 0) {\n                func.push(\"&&\");\n            }\n            func.push(\"(\");\n            if (filter.appliesTo) {\n                func.push(\"!(\");\n                filter.appliesTo.forEach(function (path, index) {\n                    if (index > 0) {\n                        func.push(\"||\");\n                    }\n                    func.push(\"(pathToRegexp('\" + Utils.normalizePath(path) + \"').test(req.path))\");\n                });\n                func.push(\") ? accepted :\");\n            }\n            var p = path.join(_this.settings.middlewarePath, 'filter', filter.name);\n            func.push(\"require('\" + p + \"')(req, res)\");\n            func.push(\")\");\n        });\n        func.push(\");\");\n        func.push(\"return accepted;\");\n        func.push(\"}\");\n        var f;\n        eval('f = ' + func.join('\\n'));\n        return f;\n    };\n    ProxyFilter.prototype.buildAllowFilter = function (allow) {\n        var func = new Array();\n        func.push(\"function(req, res){\");\n        func.push(\"var accepted = true;\");\n        func.push(\"var targetPath = req.path;\");\n        if (allow.path && allow.path.length > 0) {\n            func.push(\"accepted = (\");\n            allow.method.forEach(function (method, index) {\n                if (index > 0) {\n                    func.push(\"||\");\n                }\n                func.push(\"(req.method === '\" + method.toUpperCase() + \"')\");\n            });\n            func.push(\");\");\n        }\n        if (allow.method && allow.method.length > 0) {\n            func.push(\"if (accepted) {\");\n            func.push(\"accepted = (\");\n            allow.path.forEach(function (path, index) {\n                if (index > 0) {\n                    func.push(\"||\");\n                }\n                func.push(\"(pathToRegexp('\" + Utils.normalizePath(path) + \"').test(targetPath))\");\n            });\n            func.push(\");\");\n            func.push(\"}\");\n        }\n        func.push(\"return accepted;\");\n        func.push(\"}\");\n        var f;\n        eval('f = ' + func.join(''));\n        return f;\n    };\n    ProxyFilter.prototype.buildDenyFilter = function (deny) {\n        var func = new Array();\n        func.push(\"function(req, res){\");\n        func.push(\"var accepted = true;\");\n        func.push(\"var targetPath = req.path;\");\n        if (deny.path && deny.path.length > 0) {\n            func.push(\"accepted = (\");\n            deny.method.forEach(function (method, index) {\n                if (index > 0) {\n                    func.push(\"&&\");\n                }\n                func.push(\"(req.method !== '\" + method.toUpperCase() + \"')\");\n            });\n            func.push(\");\");\n        }\n        if (deny.method && deny.method.length > 0) {\n            func.push(\"if (accepted) {\");\n            func.push(\"accepted = (\");\n            deny.path.forEach(function (path, index) {\n                if (index > 0) {\n                    func.push(\"&&\");\n                }\n                func.push(\"!(pathToRegexp('\" + Utils.normalizePath(path) + \"').test(targetPath))\");\n            });\n            func.push(\");\");\n            func.push(\"}\");\n        }\n        func.push(\"return accepted;\");\n        func.push(\"}\");\n        var f;\n        eval('f = ' + func.join(''));\n        return f;\n    };\n    ProxyFilter.prototype.hasCustomFilter = function (proxy) {\n        return (proxy.filter && proxy.filter.length > 0);\n    };\n    __decorate([\n        typescript_ioc_1.Inject, \n        __metadata('design:type', settings_1.Settings)\n    ], ProxyFilter.prototype, \"settings\", void 0);\n    ProxyFilter = __decorate([\n        typescript_ioc_1.AutoWired, \n        __metadata('design:paramtypes', [])\n    ], ProxyFilter);\n    return ProxyFilter;\n}());\nexports.ProxyFilter = ProxyFilter;\n","\"use strict\";\n\nimport * as StringUtils from \"underscore.string\";\nimport * as config from \"../config\";\nimport * as Utils from \"./utils\";\nimport {AutoWired, Inject} from \"typescript-ioc\";\nimport {Settings} from \"../settings\";\nimport * as path from \"path\"; \n\nlet pathToRegexp = require('path-to-regexp');\n \n@AutoWired\nexport class ProxyFilter {\n    @Inject\n    private settings: Settings;\n    buildFilters(proxy: config.Proxy) {\n        let filterChain = new Array<Function>();\n        if (proxy.target.allow) {\n            filterChain.push(this.buildAllowFilter(proxy.target.allow));\n        }\n        if (proxy.target.deny) {\n          filterChain.push(this.buildDenyFilter(proxy.target.deny));\n        }\n        if (this.hasCustomFilter(proxy)) {\n          filterChain.push(this.buildCustomFilter(proxy));\n        }\n        return filterChain;\n    }\n\n    private buildCustomFilter(proxy: config.Proxy) {\n        let func = new Array<string>();\n        func.push(\"function(req, res){\");\n        func.push(\"var accepted = true;\");\n        func.push(\"accepted = (\");\n        proxy.filter.forEach((filter, index)=>{\n            if (index > 0) {\n                func.push(\"&&\");                \n            }\n            func.push(\"(\");                \n            if (filter.appliesTo) {\n                func.push(\"!(\");                \n                filter.appliesTo.forEach((path,index)=>{\n                    if (index > 0) {\n                        func.push(\"||\");                \n                    }                \n                    func.push(\"(pathToRegexp('\"+Utils.normalizePath(path)+\"').test(req.path))\");\n\n                });\n                func.push(\") ? accepted :\");                \n            }\n            let p = path.join(this.settings.middlewarePath, 'filter' ,filter.name);                \n            func.push(\"require('\"+p+\"')(req, res)\");\n            func.push(\")\");                \n        });\n        func.push(\");\");\n        func.push(\"return accepted;\");\n        func.push(\"}\");\n        let f;\n        eval('f = '+func.join('\\n'))\n        return f;\n    }\n\n    private buildAllowFilter(allow: config.TargetFilter) {\n        let func = new Array<string>();\n        func.push(\"function(req, res){\");\n        func.push(\"var accepted = true;\");\n        func.push(\"var targetPath = req.path;\");\n        if (allow.path && allow.path.length > 0) {\n            func.push(\"accepted = (\");\n            allow.method.forEach((method, index)=>{\n                if (index > 0) {\n                    func.push(\"||\");                \n                }\n                func.push(\"(req.method === '\"+method.toUpperCase()+\"')\")\n            });\n            func.push(\");\");\n        }\n        if (allow.method && allow.method.length > 0) {\n            func.push(\"if (accepted) {\");\n            func.push(\"accepted = (\");\n            allow.path.forEach((path, index)=>{\n                if (index > 0) {\n                    func.push(\"||\");                \n                }                \n                func.push(\"(pathToRegexp('\"+Utils.normalizePath(path)+\"').test(targetPath))\");\n            });\n            func.push(\");\");\n            func.push(\"}\");\n        }\n        func.push(\"return accepted;\");\n        func.push(\"}\");\n        let f;\n        eval('f = '+func.join(''))\n        return f;\n    }\n\n    private buildDenyFilter(deny: config.TargetFilter) {\n        let func = new Array<string>();\n        func.push(\"function(req, res){\");\n        func.push(\"var accepted = true;\");\n        func.push(\"var targetPath = req.path;\");\n        if (deny.path && deny.path.length > 0) {\n            func.push(\"accepted = (\");\n            deny.method.forEach((method, index)=>{\n                if (index > 0) {\n                    func.push(\"&&\");                \n                }\n                func.push(\"(req.method !== '\"+method.toUpperCase()+\"')\")\n            });\n            func.push(\");\");\n        }\n        if (deny.method && deny.method.length > 0) {\n            func.push(\"if (accepted) {\");\n            func.push(\"accepted = (\");\n            deny.path.forEach((path, index)=>{\n                if (index > 0) {\n                    func.push(\"&&\");                \n                }                \n                func.push(\"!(pathToRegexp('\"+Utils.normalizePath(path)+\"').test(targetPath))\");\n            });\n            func.push(\");\");\n            func.push(\"}\");\n        }\n        func.push(\"return accepted;\");\n        func.push(\"}\");\n        let f;\n        eval('f = '+func.join(''))\n        return f;\n    }\n\n    private hasCustomFilter(proxy: config.Proxy) {\n        return (proxy.filter && proxy.filter.length > 0);\n    }\n}  "]}