"use strict";
var __cov_CuWnC1XAx6FXCmACM3ruFw = (Function('return this'))();
if (!__cov_CuWnC1XAx6FXCmACM3ruFw.$$cov_1478616766663$$) { __cov_CuWnC1XAx6FXCmACM3ruFw.$$cov_1478616766663$$ = {}; }
__cov_CuWnC1XAx6FXCmACM3ruFw = __cov_CuWnC1XAx6FXCmACM3ruFw.$$cov_1478616766663$$;
if (!(__cov_CuWnC1XAx6FXCmACM3ruFw['/Users/thiago/git/tree-gateway/bin/lib/proxy/proxy.js'])) {
   __cov_CuWnC1XAx6FXCmACM3ruFw['/Users/thiago/git/tree-gateway/bin/lib/proxy/proxy.js'] = {"path":"/Users/thiago/git/tree-gateway/bin/lib/proxy/proxy.js","s":{"1":0,"2":0,"3":0,"4":0,"5":1,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0},"fnMap":{"1":{"name":"(anonymous_1)","line":5,"loc":{"start":{"line":5,"column":16},"end":{"line":5,"column":28}}},"2":{"name":"ApiProxy","line":6,"loc":{"start":{"line":6,"column":4},"end":{"line":6,"column":31}}},"3":{"name":"(anonymous_3)","line":11,"loc":{"start":{"line":11,"column":31},"end":{"line":11,"column":46}}},"4":{"name":"(anonymous_4)","line":14,"loc":{"start":{"line":14,"column":40},"end":{"line":14,"column":57}}},"5":{"name":"(anonymous_5)","line":16,"loc":{"start":{"line":16,"column":25},"end":{"line":16,"column":45}}},"6":{"name":"(anonymous_6)","line":31,"loc":{"start":{"line":31,"column":31},"end":{"line":31,"column":51}}},"7":{"name":"(anonymous_7)","line":33,"loc":{"start":{"line":33,"column":36},"end":{"line":33,"column":49}}}},"statementMap":{"1":{"start":{"line":2,"column":0},"end":{"line":2,"column":35}},"2":{"start":{"line":3,"column":0},"end":{"line":3,"column":45}},"3":{"start":{"line":4,"column":0},"end":{"line":4,"column":42}},"4":{"start":{"line":5,"column":0},"end":{"line":52,"column":5}},"5":{"start":{"line":6,"column":4},"end":{"line":10,"column":5}},"6":{"start":{"line":7,"column":8},"end":{"line":7,"column":31}},"7":{"start":{"line":8,"column":8},"end":{"line":8,"column":53}},"8":{"start":{"line":9,"column":8},"end":{"line":9,"column":68}},"9":{"start":{"line":11,"column":4},"end":{"line":13,"column":6}},"10":{"start":{"line":12,"column":8},"end":{"line":12,"column":110}},"11":{"start":{"line":14,"column":4},"end":{"line":50,"column":6}},"12":{"start":{"line":15,"column":8},"end":{"line":19,"column":10}},"13":{"start":{"line":17,"column":16},"end":{"line":17,"column":31}},"14":{"start":{"line":20,"column":8},"end":{"line":22,"column":9}},"15":{"start":{"line":21,"column":12},"end":{"line":21,"column":62}},"16":{"start":{"line":23,"column":8},"end":{"line":25,"column":9}},"17":{"start":{"line":24,"column":12},"end":{"line":24,"column":46}},"18":{"start":{"line":26,"column":8},"end":{"line":28,"column":9}},"19":{"start":{"line":27,"column":12},"end":{"line":27,"column":42}},"20":{"start":{"line":29,"column":8},"end":{"line":29,"column":58}},"21":{"start":{"line":30,"column":8},"end":{"line":40,"column":9}},"22":{"start":{"line":31,"column":12},"end":{"line":39,"column":14}},"23":{"start":{"line":32,"column":16},"end":{"line":32,"column":34}},"24":{"start":{"line":33,"column":16},"end":{"line":37,"column":19}},"25":{"start":{"line":34,"column":20},"end":{"line":36,"column":21}},"26":{"start":{"line":35,"column":24},"end":{"line":35,"column":45}},"27":{"start":{"line":38,"column":16},"end":{"line":38,"column":30}},"28":{"start":{"line":41,"column":8},"end":{"line":41,"column":76}},"29":{"start":{"line":42,"column":8},"end":{"line":44,"column":9}},"30":{"start":{"line":43,"column":12},"end":{"line":43,"column":59}},"31":{"start":{"line":45,"column":8},"end":{"line":45,"column":78}},"32":{"start":{"line":46,"column":8},"end":{"line":48,"column":9}},"33":{"start":{"line":47,"column":12},"end":{"line":47,"column":54}},"34":{"start":{"line":49,"column":8},"end":{"line":49,"column":22}},"35":{"start":{"line":51,"column":4},"end":{"line":51,"column":20}},"36":{"start":{"line":53,"column":0},"end":{"line":53,"column":28}}},"branchMap":{"1":{"line":20,"type":"if","locations":[{"start":{"line":20,"column":8},"end":{"line":20,"column":8}},{"start":{"line":20,"column":8},"end":{"line":20,"column":8}}]},"2":{"line":23,"type":"if","locations":[{"start":{"line":23,"column":8},"end":{"line":23,"column":8}},{"start":{"line":23,"column":8},"end":{"line":23,"column":8}}]},"3":{"line":26,"type":"if","locations":[{"start":{"line":26,"column":8},"end":{"line":26,"column":8}},{"start":{"line":26,"column":8},"end":{"line":26,"column":8}}]},"4":{"line":30,"type":"if","locations":[{"start":{"line":30,"column":8},"end":{"line":30,"column":8}},{"start":{"line":30,"column":8},"end":{"line":30,"column":8}}]},"5":{"line":30,"type":"binary-expr","locations":[{"start":{"line":30,"column":12},"end":{"line":30,"column":23}},{"start":{"line":30,"column":27},"end":{"line":30,"column":49}}]},"6":{"line":34,"type":"if","locations":[{"start":{"line":34,"column":20},"end":{"line":34,"column":20}},{"start":{"line":34,"column":20},"end":{"line":34,"column":20}}]},"7":{"line":42,"type":"if","locations":[{"start":{"line":42,"column":8},"end":{"line":42,"column":8}},{"start":{"line":42,"column":8},"end":{"line":42,"column":8}}]},"8":{"line":46,"type":"if","locations":[{"start":{"line":46,"column":8},"end":{"line":46,"column":8}},{"start":{"line":46,"column":8},"end":{"line":46,"column":8}}]}}};
}
__cov_CuWnC1XAx6FXCmACM3ruFw = __cov_CuWnC1XAx6FXCmACM3ruFw['/Users/thiago/git/tree-gateway/bin/lib/proxy/proxy.js'];
__cov_CuWnC1XAx6FXCmACM3ruFw.s['1']++;
var filter_1 = require('./filter');
__cov_CuWnC1XAx6FXCmACM3ruFw.s['2']++;
var interceptor_1 = require('./interceptor');
__cov_CuWnC1XAx6FXCmACM3ruFw.s['3']++;
var proxy = require('express-http-proxy');
__cov_CuWnC1XAx6FXCmACM3ruFw.s['4']++;
var ApiProxy = function () {
    __cov_CuWnC1XAx6FXCmACM3ruFw.f['1']++;
    function ApiProxy(gateway) {
        __cov_CuWnC1XAx6FXCmACM3ruFw.f['2']++;
        __cov_CuWnC1XAx6FXCmACM3ruFw.s['6']++;
        this.gateway = gateway;
        __cov_CuWnC1XAx6FXCmACM3ruFw.s['7']++;
        this.filter = new filter_1.ProxyFilter(this);
        __cov_CuWnC1XAx6FXCmACM3ruFw.s['8']++;
        this.interceptor = new interceptor_1.ProxyInterceptor(this);
    }
    __cov_CuWnC1XAx6FXCmACM3ruFw.s['9']++;
    ApiProxy.prototype.proxy = function (api) {
        __cov_CuWnC1XAx6FXCmACM3ruFw.f['3']++;
        __cov_CuWnC1XAx6FXCmACM3ruFw.s['10']++;
        this.gateway.server.use(api.proxy.path, proxy(api.proxy.target.path, this.configureProxy(api.proxy)));
    };
    __cov_CuWnC1XAx6FXCmACM3ruFw.s['11']++;
    ApiProxy.prototype.configureProxy = function (proxy) {
        __cov_CuWnC1XAx6FXCmACM3ruFw.f['4']++;
        __cov_CuWnC1XAx6FXCmACM3ruFw.s['12']++;
        var result = {
            forwardPath: function (req, res) {
                __cov_CuWnC1XAx6FXCmACM3ruFw.f['5']++;
                __cov_CuWnC1XAx6FXCmACM3ruFw.s['13']++;
                return req.url;
            }
        };
        __cov_CuWnC1XAx6FXCmACM3ruFw.s['14']++;
        if (proxy.preserveHostHdr) {
            __cov_CuWnC1XAx6FXCmACM3ruFw.b['1'][0]++;
            __cov_CuWnC1XAx6FXCmACM3ruFw.s['15']++;
            result['preserveHostHdr'] = proxy.preserveHostHdr;
        } else {
            __cov_CuWnC1XAx6FXCmACM3ruFw.b['1'][1]++;
        }
        __cov_CuWnC1XAx6FXCmACM3ruFw.s['16']++;
        if (proxy.timeout) {
            __cov_CuWnC1XAx6FXCmACM3ruFw.b['2'][0]++;
            __cov_CuWnC1XAx6FXCmACM3ruFw.s['17']++;
            result['timeout'] = proxy.timeout;
        } else {
            __cov_CuWnC1XAx6FXCmACM3ruFw.b['2'][1]++;
        }
        __cov_CuWnC1XAx6FXCmACM3ruFw.s['18']++;
        if (proxy.https) {
            __cov_CuWnC1XAx6FXCmACM3ruFw.b['3'][0]++;
            __cov_CuWnC1XAx6FXCmACM3ruFw.s['19']++;
            result['https'] = proxy.https;
        } else {
            __cov_CuWnC1XAx6FXCmACM3ruFw.b['3'][1]++;
        }
        __cov_CuWnC1XAx6FXCmACM3ruFw.s['20']++;
        var filterChain = this.filter.buildFilters(proxy);
        __cov_CuWnC1XAx6FXCmACM3ruFw.s['21']++;
        if ((__cov_CuWnC1XAx6FXCmACM3ruFw.b['5'][0]++, filterChain) && (__cov_CuWnC1XAx6FXCmACM3ruFw.b['5'][1]++, filterChain.length > 0)) {
            __cov_CuWnC1XAx6FXCmACM3ruFw.b['4'][0]++;
            __cov_CuWnC1XAx6FXCmACM3ruFw.s['22']++;
            result['filter'] = function (req, res) {
                __cov_CuWnC1XAx6FXCmACM3ruFw.f['6']++;
                __cov_CuWnC1XAx6FXCmACM3ruFw.s['23']++;
                var result = true;
                __cov_CuWnC1XAx6FXCmACM3ruFw.s['24']++;
                filterChain.forEach(function (f) {
                    __cov_CuWnC1XAx6FXCmACM3ruFw.f['7']++;
                    __cov_CuWnC1XAx6FXCmACM3ruFw.s['25']++;
                    if (result) {
                        __cov_CuWnC1XAx6FXCmACM3ruFw.b['6'][0]++;
                        __cov_CuWnC1XAx6FXCmACM3ruFw.s['26']++;
                        result = f(req, res);
                    } else {
                        __cov_CuWnC1XAx6FXCmACM3ruFw.b['6'][1]++;
                    }
                });
                __cov_CuWnC1XAx6FXCmACM3ruFw.s['27']++;
                return result;
            };
        } else {
            __cov_CuWnC1XAx6FXCmACM3ruFw.b['4'][1]++;
        }
        __cov_CuWnC1XAx6FXCmACM3ruFw.s['28']++;
        var requestInterceptor = this.interceptor.requestInterceptor(proxy);
        __cov_CuWnC1XAx6FXCmACM3ruFw.s['29']++;
        if (requestInterceptor) {
            __cov_CuWnC1XAx6FXCmACM3ruFw.b['7'][0]++;
            __cov_CuWnC1XAx6FXCmACM3ruFw.s['30']++;
            result['decorateRequest'] = requestInterceptor;
        } else {
            __cov_CuWnC1XAx6FXCmACM3ruFw.b['7'][1]++;
        }
        __cov_CuWnC1XAx6FXCmACM3ruFw.s['31']++;
        var responseInterceptor = this.interceptor.responseInterceptor(proxy);
        __cov_CuWnC1XAx6FXCmACM3ruFw.s['32']++;
        if (responseInterceptor) {
            __cov_CuWnC1XAx6FXCmACM3ruFw.b['8'][0]++;
            __cov_CuWnC1XAx6FXCmACM3ruFw.s['33']++;
            result['intercept'] = responseInterceptor;
        } else {
            __cov_CuWnC1XAx6FXCmACM3ruFw.b['8'][1]++;
        }
        __cov_CuWnC1XAx6FXCmACM3ruFw.s['34']++;
        return result;
    };
    __cov_CuWnC1XAx6FXCmACM3ruFw.s['35']++;
    return ApiProxy;
}();
__cov_CuWnC1XAx6FXCmACM3ruFw.s['36']++;
exports.ApiProxy = ApiProxy;

//# sourceMappingURL=proxy.js.map
