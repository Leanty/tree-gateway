{"version":3,"sources":["../../src/lib/command-line.ts"],"names":["express","require","winston","settings_1","path","StringUtils","typescript_ioc_1","redis","args","parameters","option","__dirname","parse","process","argv","Parameters","exports","rootDir","dir","port","adminPort","startsWith","join","cwd","provider","get","settings","Settings","app","redisClient","apiPath","middlewarePath","Container","bind","add","transports","File","filename"],"mappings":";;;;;;;;;AAEA,IAAYA,OAAA,GAAOC,OAAA,CAAM,SAAN,CAAnB,C;;AACA,IAAYC,OAAA,GAAOD,OAAA,CAAM,SAAN,CAAnB,C;;AACA,IAAAE,UAAA,GAAAF,OAAA,CAAuB,iBAAvB,CAAA,C;;AACA,IAAYG,IAAA,GAAIH,OAAA,CAAM,MAAN,CAAhB,C;;AACA,IAAYI,WAAA,GAAWJ,OAAA,CAAM,mBAAN,CAAvB,C;;AACA,IAAAK,gBAAA,GAAAL,OAAA,CAAkC,gBAAlC,CAAA,C;;AACA,IAAYM,KAAA,GAAKN,OAAA,CAAM,SAAN,CAAjB,C;;AAEA,IAAIO,IAAA,GAAOP,OAAA,CAAQ,MAAR,CAAX,C;;AAEA,IAAIQ,UAAA,GAAaD,IAAA,CACdE,MADc,CACP,KADO,EACA,2DADA,EAC6DC,SAD7D,EAEdD,MAFc,CAEP,MAFO,EAEC,0BAFD,EAE6B,IAF7B,EAGdA,MAHc,CAGP,WAHO,EAGM,uCAHN,EAG+C,IAH/C,EAIdE,KAJc,CAIRC,OAAA,CAAQC,IAJA,CAAjB,C;;AAMA,IAAAC,UAAA,GAAA,YAAA;AAAA,I,sCAAA;AAAA,IAAA,SAAAA,UAAA,GAAA;AAAA,Q,sCAAA;AAAA,KAAA;AAAA,I,uCAAA;AAAA,IAIA,OAAAA,UAAA,CAJA;AAAA,CAAA,EAAA,C;;AAAaC,OAAA,CAAAD,UAAA,GAAUA,UAAV,C;;AAMbA,UAAA,CAAWE,OAAX,GAAqBR,UAAA,CAAWS,GAAhC,C;;AACAH,UAAA,CAAWI,IAAX,GAAkBV,UAAA,CAAWU,IAA7B,C;;AACAJ,UAAA,CAAWK,SAAX,GAAuBX,UAAA,CAAWW,SAAlC,C;;AAEA,IAAIf,WAAA,CAAYgB,UAAZ,CAAuBN,UAAA,CAAWE,OAAlC,EAA2C,GAA3C,CAAJ,EAAqD;AAAA,I,yCAAA;AAAA,I,uCAAA;AAAA,IACnDF,UAAA,CAAWE,OAAX,GAAqBb,IAAA,CAAKkB,IAAL,CAAUT,OAAA,CAAQU,GAAR,EAAV,EAAyBR,UAAA,CAAWE,OAApC,CAArB,CADmD;AAAA,CAArD,M;;;;AAGA,IAAMO,QAAA,GAAqB;AAAA,IACzBC,GAAA,EAAK,YAAA;AAAA,Q,sCAAA;AAAA,Q,uCAAA;AAAA,QACH,IAAMC,QAAA,GAAqB,IAAIvB,UAAA,CAAAwB,QAAJ,EAA3B,CADG;AAAA,Q,uCAAA;AAAA,QAEHD,QAAA,CAASE,GAAT,GAAe5B,OAAA,EAAf,CAFG;AAAA,Q,uCAAA;AAAA,QAGH0B,QAAA,CAASG,WAAT,GAAuB,IAAItB,KAAJ,CAAU,IAAV,EAAgB,WAAhB,CAAvB,CAHG;AAAA,Q,uCAAA;AAAA,QAIHmB,QAAA,CAASI,OAAT,GAAmB1B,IAAA,CAAKkB,IAAL,CAAUP,UAAA,CAAWE,OAArB,EAA8B,MAA9B,CAAnB,CAJG;AAAA,Q,uCAAA;AAAA,QAKHS,QAAA,CAASK,cAAT,GAA0B3B,IAAA,CAAKkB,IAAL,CAAUP,UAAA,CAAWE,OAArB,EAA8B,YAA9B,CAA1B,CALG;AAAA,Q,uCAAA;AAAA,QAMD,OAAOS,QAAP,CANC;AAAA,KADoB;AAAA,CAA3B,C;;AAWApB,gBAAA,CAAA0B,SAAA,CAAUC,IAAV,CAAe9B,UAAA,CAAAwB,QAAf,EAAyBH,QAAzB,CAAkCA,QAAlC,E;;AACAtB,OAAA,CAAQgC,GAAR,CAAYhC,OAAA,CAAQiC,UAAR,CAAmBC,IAA/B,EAAqC,EAAEC,QAAA,EAAUjC,IAAA,CAAKkB,IAAL,CAAUP,UAAA,CAAWE,OAArB,EAA8B,kBAA9B,CAAZ,EAArC","file":"command-line.js","sourcesContent":["\"use strict\";\n\nimport * as express from \"express\";\nimport * as winston from \"winston\";\nimport {Settings} from \"../lib/settings\";\nimport * as path from \"path\";\nimport * as StringUtils from \"underscore.string\";\nimport {Container, Provider} from \"typescript-ioc\";\nimport * as redis from \"ioredis\";\n\nlet args = require(\"args\");\n\nlet parameters = args\n  .option('dir', 'The root directory where apis and middlewares are placed.', __dirname)\n  .option('port', 'The gateway listen port.', 8000)\n  .option('adminPort', 'The gateway admin server listen port.', 8001)\n  .parse(process.argv);\n\nexport class Parameters {\n    static rootDir: string;\n    static port: number;\n    static adminPort: number;\n}\n\nParameters.rootDir = parameters.dir;\nParameters.port = parameters.port;\nParameters.adminPort = parameters.adminPort;\n\nif (StringUtils.startsWith(Parameters.rootDir, '.')) {\n  Parameters.rootDir = path.join(process.cwd(), Parameters.rootDir);                \n}\nconst provider: Provider = { \n  get: () => {\n    const settings: Settings = new Settings();\n    settings.app = express();\n    settings.redisClient = new redis(6379, 'localhost');\n    settings.apiPath = path.join(Parameters.rootDir, 'apis');\n    settings.middlewarePath = path.join(Parameters.rootDir ,'middleware');\n      return settings; \n  }\n};\n\nContainer.bind(Settings).provider(provider);\nwinston.add(winston.transports.File, { filename: path.join(Parameters.rootDir, 'logs/gateway.log') });\n"]}