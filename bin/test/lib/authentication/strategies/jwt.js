"use strict";
var __cov_6V9m$pFtY9RnlvQsExAs8g = (Function('return this'))();
if (!__cov_6V9m$pFtY9RnlvQsExAs8g.$$cov_1478206605909$$) { __cov_6V9m$pFtY9RnlvQsExAs8g.$$cov_1478206605909$$ = {}; }
__cov_6V9m$pFtY9RnlvQsExAs8g = __cov_6V9m$pFtY9RnlvQsExAs8g.$$cov_1478206605909$$;
if (!(__cov_6V9m$pFtY9RnlvQsExAs8g['/Users/thiago/git/tree-gateway/bin/lib/authentication/strategies/jwt.js'])) {
   __cov_6V9m$pFtY9RnlvQsExAs8g['/Users/thiago/git/tree-gateway/bin/lib/authentication/strategies/jwt.js'] = {"path":"/Users/thiago/git/tree-gateway/bin/lib/authentication/strategies/jwt.js","s":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":1,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0,0,0,0],"5":[0,0],"6":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0},"fnMap":{"1":{"name":"(anonymous_1)","line":6,"loc":{"start":{"line":6,"column":17},"end":{"line":6,"column":57}}},"2":{"name":"(anonymous_2)","line":15,"loc":{"start":{"line":15,"column":55},"end":{"line":15,"column":76}}},"3":{"name":"(anonymous_3)","line":31,"loc":{"start":{"line":31,"column":25},"end":{"line":31,"column":54}}},"4":{"name":"getExtractor","line":37,"loc":{"start":{"line":37,"column":0},"end":{"line":37,"column":40}}},"5":{"name":"(anonymous_5)","line":43,"loc":{"start":{"line":43,"column":30},"end":{"line":43,"column":45}}}},"statementMap":{"1":{"start":{"line":2,"column":0},"end":{"line":2,"column":35}},"2":{"start":{"line":3,"column":0},"end":{"line":3,"column":45}},"3":{"start":{"line":4,"column":0},"end":{"line":4,"column":34}},"4":{"start":{"line":5,"column":0},"end":{"line":5,"column":31}},"5":{"start":{"line":6,"column":0},"end":{"line":36,"column":2}},"6":{"start":{"line":7,"column":4},"end":{"line":7,"column":63}},"7":{"start":{"line":8,"column":4},"end":{"line":23,"column":5}},"8":{"start":{"line":9,"column":8},"end":{"line":9,"column":60}},"9":{"start":{"line":10,"column":8},"end":{"line":19,"column":9}},"10":{"start":{"line":11,"column":12},"end":{"line":11,"column":104}},"11":{"start":{"line":14,"column":12},"end":{"line":14,"column":50}},"12":{"start":{"line":15,"column":12},"end":{"line":17,"column":15}},"13":{"start":{"line":16,"column":16},"end":{"line":16,"column":101}},"14":{"start":{"line":18,"column":12},"end":{"line":18,"column":102}},"15":{"start":{"line":22,"column":8},"end":{"line":22,"column":76}},"16":{"start":{"line":24,"column":4},"end":{"line":24,"column":23}},"17":{"start":{"line":25,"column":4},"end":{"line":34,"column":5}},"18":{"start":{"line":26,"column":8},"end":{"line":26,"column":41}},"19":{"start":{"line":27,"column":8},"end":{"line":27,"column":102}},"20":{"start":{"line":28,"column":8},"end":{"line":28,"column":36}},"21":{"start":{"line":31,"column":8},"end":{"line":33,"column":10}},"22":{"start":{"line":32,"column":12},"end":{"line":32,"column":36}},"23":{"start":{"line":35,"column":4},"end":{"line":35,"column":76}},"24":{"start":{"line":37,"column":0},"end":{"line":52,"column":1}},"25":{"start":{"line":38,"column":4},"end":{"line":50,"column":5}},"26":{"start":{"line":39,"column":23},"end":{"line":39,"column":74}},"27":{"start":{"line":40,"column":27},"end":{"line":40,"column":89}},"28":{"start":{"line":41,"column":27},"end":{"line":41,"column":92}},"29":{"start":{"line":42,"column":26},"end":{"line":42,"column":80}},"30":{"start":{"line":43,"column":23},"end":{"line":49,"column":10}},"31":{"start":{"line":44,"column":12},"end":{"line":44,"column":29}},"32":{"start":{"line":45,"column":12},"end":{"line":47,"column":13}},"33":{"start":{"line":46,"column":16},"end":{"line":46,"column":43}},"34":{"start":{"line":48,"column":12},"end":{"line":48,"column":25}},"35":{"start":{"line":51,"column":4},"end":{"line":51,"column":54}}},"branchMap":{"1":{"line":8,"type":"if","locations":[{"start":{"line":8,"column":4},"end":{"line":8,"column":4}},{"start":{"line":8,"column":4},"end":{"line":8,"column":4}}]},"2":{"line":10,"type":"if","locations":[{"start":{"line":10,"column":8},"end":{"line":10,"column":8}},{"start":{"line":10,"column":8},"end":{"line":10,"column":8}}]},"3":{"line":25,"type":"if","locations":[{"start":{"line":25,"column":4},"end":{"line":25,"column":4}},{"start":{"line":25,"column":4},"end":{"line":25,"column":4}}]},"4":{"line":38,"type":"switch","locations":[{"start":{"line":39,"column":8},"end":{"line":39,"column":74}},{"start":{"line":40,"column":8},"end":{"line":40,"column":89}},{"start":{"line":41,"column":8},"end":{"line":41,"column":92}},{"start":{"line":42,"column":8},"end":{"line":42,"column":80}},{"start":{"line":43,"column":8},"end":{"line":49,"column":10}}]},"5":{"line":45,"type":"if","locations":[{"start":{"line":45,"column":12},"end":{"line":45,"column":12}},{"start":{"line":45,"column":12},"end":{"line":45,"column":12}}]},"6":{"line":45,"type":"binary-expr","locations":[{"start":{"line":45,"column":16},"end":{"line":45,"column":19}},{"start":{"line":45,"column":23},"end":{"line":45,"column":34}}]}}};
}
__cov_6V9m$pFtY9RnlvQsExAs8g = __cov_6V9m$pFtY9RnlvQsExAs8g['/Users/thiago/git/tree-gateway/bin/lib/authentication/strategies/jwt.js'];
__cov_6V9m$pFtY9RnlvQsExAs8g.s['1']++;
var passport = require('passport');
__cov_6V9m$pFtY9RnlvQsExAs8g.s['2']++;
var passport_jwt_1 = require('passport-jwt');
__cov_6V9m$pFtY9RnlvQsExAs8g.s['3']++;
var Utils = require('underscore');
__cov_6V9m$pFtY9RnlvQsExAs8g.s['4']++;
var pathUtil = require('path');
__cov_6V9m$pFtY9RnlvQsExAs8g.s['5']++;
module.exports = function (apiKey, authConfig, settings) {
    __cov_6V9m$pFtY9RnlvQsExAs8g.f['1']++;
    __cov_6V9m$pFtY9RnlvQsExAs8g.s['6']++;
    var opts = Utils.omit(authConfig, 'extractFrom', 'verify');
    __cov_6V9m$pFtY9RnlvQsExAs8g.s['7']++;
    if (authConfig.extractFrom) {
        __cov_6V9m$pFtY9RnlvQsExAs8g.b['1'][0]++;
        __cov_6V9m$pFtY9RnlvQsExAs8g.s['8']++;
        var extractors = Utils.keys(authConfig.extractFrom);
        __cov_6V9m$pFtY9RnlvQsExAs8g.s['9']++;
        if (extractors.length == 1) {
            __cov_6V9m$pFtY9RnlvQsExAs8g.b['2'][0]++;
            __cov_6V9m$pFtY9RnlvQsExAs8g.s['10']++;
            opts['jwtFromRequest'] = getExtractor(extractors[0], authConfig.extractFrom[extractors[0]]);
        } else {
            __cov_6V9m$pFtY9RnlvQsExAs8g.b['2'][1]++;
            __cov_6V9m$pFtY9RnlvQsExAs8g.s['11']++;
            var requestExtractors_1 = new Array();
            __cov_6V9m$pFtY9RnlvQsExAs8g.s['12']++;
            Utils.keys(authConfig.extractFrom).forEach(function (extractor) {
                __cov_6V9m$pFtY9RnlvQsExAs8g.f['2']++;
                __cov_6V9m$pFtY9RnlvQsExAs8g.s['13']++;
                requestExtractors_1.push(getExtractor(extractor, authConfig.extractFrom[extractor]));
            });
            __cov_6V9m$pFtY9RnlvQsExAs8g.s['14']++;
            opts['jwtFromRequest'] = passport_jwt_1.ExtractJwt['fromExtractors'](requestExtractors_1);
        }
    } else {
        __cov_6V9m$pFtY9RnlvQsExAs8g.b['1'][1]++;
        __cov_6V9m$pFtY9RnlvQsExAs8g.s['15']++;
        opts['jwtFromRequest'] = passport_jwt_1.ExtractJwt.fromAuthHeader();
    }
    __cov_6V9m$pFtY9RnlvQsExAs8g.s['16']++;
    var verifyFunction;
    __cov_6V9m$pFtY9RnlvQsExAs8g.s['17']++;
    if (authConfig.verify) {
        __cov_6V9m$pFtY9RnlvQsExAs8g.b['3'][0]++;
        __cov_6V9m$pFtY9RnlvQsExAs8g.s['18']++;
        opts['passReqToCallback'] = true;
        __cov_6V9m$pFtY9RnlvQsExAs8g.s['19']++;
        var p = pathUtil.join(settings.middlewarePath, 'authentication', 'verify', authConfig.verify);
        __cov_6V9m$pFtY9RnlvQsExAs8g.s['20']++;
        verifyFunction = require(p);
    } else {
        __cov_6V9m$pFtY9RnlvQsExAs8g.b['3'][1]++;
        __cov_6V9m$pFtY9RnlvQsExAs8g.s['21']++;
        verifyFunction = function (jwt_payload, done) {
            __cov_6V9m$pFtY9RnlvQsExAs8g.f['3']++;
            __cov_6V9m$pFtY9RnlvQsExAs8g.s['22']++;
            done(null, jwt_payload);
        };
    }
    __cov_6V9m$pFtY9RnlvQsExAs8g.s['23']++;
    passport.use(apiKey, new passport_jwt_1.Strategy(opts, verifyFunction));
};
function getExtractor(extractor, param) {
    __cov_6V9m$pFtY9RnlvQsExAs8g.f['4']++;
    __cov_6V9m$pFtY9RnlvQsExAs8g.s['25']++;
    switch (extractor) {
    case 'header':
        __cov_6V9m$pFtY9RnlvQsExAs8g.b['4'][0]++;
        __cov_6V9m$pFtY9RnlvQsExAs8g.s['26']++;
        return passport_jwt_1.ExtractJwt.fromHeader(param);
    case 'queryParam':
        __cov_6V9m$pFtY9RnlvQsExAs8g.b['4'][1]++;
        __cov_6V9m$pFtY9RnlvQsExAs8g.s['27']++;
        return passport_jwt_1.ExtractJwt.fromUrlQueryParameter(param);
    case 'authHeader':
        __cov_6V9m$pFtY9RnlvQsExAs8g.b['4'][2]++;
        __cov_6V9m$pFtY9RnlvQsExAs8g.s['28']++;
        return passport_jwt_1.ExtractJwt.fromAuthHeaderWithScheme(param);
    case 'bodyField':
        __cov_6V9m$pFtY9RnlvQsExAs8g.b['4'][3]++;
        __cov_6V9m$pFtY9RnlvQsExAs8g.s['29']++;
        return passport_jwt_1.ExtractJwt.fromBodyField(param);
    case 'cookie':
        __cov_6V9m$pFtY9RnlvQsExAs8g.b['4'][4]++;
        __cov_6V9m$pFtY9RnlvQsExAs8g.s['30']++;
        return function (req) {
            __cov_6V9m$pFtY9RnlvQsExAs8g.f['5']++;
            __cov_6V9m$pFtY9RnlvQsExAs8g.s['31']++;
            var token = null;
            __cov_6V9m$pFtY9RnlvQsExAs8g.s['32']++;
            if ((__cov_6V9m$pFtY9RnlvQsExAs8g.b['6'][0]++, req) && (__cov_6V9m$pFtY9RnlvQsExAs8g.b['6'][1]++, req.cookies)) {
                __cov_6V9m$pFtY9RnlvQsExAs8g.b['5'][0]++;
                __cov_6V9m$pFtY9RnlvQsExAs8g.s['33']++;
                token = req.cookies[param];
            } else {
                __cov_6V9m$pFtY9RnlvQsExAs8g.b['5'][1]++;
            }
            __cov_6V9m$pFtY9RnlvQsExAs8g.s['34']++;
            return token;
        };
    }
    __cov_6V9m$pFtY9RnlvQsExAs8g.s['35']++;
    return passport_jwt_1.ExtractJwt.fromAuthHeader();
}

//# sourceMappingURL=jwt.js.map
