{"version":3,"sources":["authentication/auth.js","../../src/lib/authentication/auth.ts"],"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","__metadata","k","v","metadata","Utils","require","typescript_ioc_1","settings_1","pathUtil","auth","providedStrategies","ApiAuth","prototype","authentication","apiKey","path","_this","keys","forEach","authConfig","has","strategy","settings","p","join","middlewarePath","app","use","authenticate","session","logger","debug","e","error","Inject","Settings","AutoWired","exports"],"mappings":"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","file":"auth.js","sourcesContent":["\"use strict\";\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __metadata = (this && this.__metadata) || function (k, v) {\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\nvar Utils = require(\"underscore\");\nvar typescript_ioc_1 = require(\"typescript-ioc\");\nvar settings_1 = require(\"../settings\");\nvar pathUtil = require(\"path\");\nvar auth = require(\"passport\");\nvar providedStrategies = {\n    'jwt': require('./strategies/jwt'),\n    'basic': require('./strategies/basic'),\n    'local': require('./strategies/local')\n};\nvar ApiAuth = (function () {\n    function ApiAuth() {\n    }\n    ApiAuth.prototype.authentication = function (apiKey, path, authentication) {\n        var _this = this;\n        Utils.keys(authentication).forEach(function (key) {\n            try {\n                var authConfig = authentication[key];\n                if (Utils.has(providedStrategies, key)) {\n                    var strategy = providedStrategies[key];\n                    strategy(apiKey, authConfig, _this.settings);\n                }\n                else {\n                    var p = pathUtil.join(_this.settings.middlewarePath, 'authentication', 'strategies', key);\n                    var strategy = require(p);\n                    strategy(apiKey, authConfig);\n                }\n                _this.settings.app.use(path, auth.authenticate(apiKey, { session: false }));\n                _this.settings.logger.debug(\"Authentication Strategy [%s] configured for path [%s]\", key, path);\n            }\n            catch (e) {\n                _this.settings.logger.error(\"Error configuring Authentication Strategy [%s] for path [%s]\", key, path, e);\n            }\n        });\n    };\n    __decorate([\n        typescript_ioc_1.Inject, \n        __metadata('design:type', settings_1.Settings)\n    ], ApiAuth.prototype, \"settings\", void 0);\n    ApiAuth = __decorate([\n        typescript_ioc_1.AutoWired, \n        __metadata('design:paramtypes', [])\n    ], ApiAuth);\n    return ApiAuth;\n}());\nexports.ApiAuth = ApiAuth;\n","\"use strict\";\n\nimport * as config from \"../config\";\nimport * as Utils from \"underscore\";\nimport {AutoWired, Inject} from \"typescript-ioc\";\nimport {Settings} from \"../settings\";\nimport * as pathUtil from \"path\"; \nimport * as auth from \"passport\"; \n\nconst providedStrategies = {\n    'jwt': require('./strategies/jwt'),\n    'basic': require('./strategies/basic'),\n    'local': require('./strategies/local')\n} \n\n@AutoWired\nexport class ApiAuth {\n    @Inject\n    private settings: Settings;\n\n    authentication(apiKey: string, path: string, authentication: config.Authentication) {\n        Utils.keys(authentication).forEach(key=>{\n            try {\n                let authConfig = authentication[key];\n                if (Utils.has(providedStrategies, key)) {\n                    let strategy = providedStrategies[key];\n                    strategy(apiKey, authConfig, this.settings);\n                }\n                else {\n                    let p = pathUtil.join(this.settings.middlewarePath, 'authentication', 'strategies' , key);                \n                    let strategy = require(p);\n                    strategy(apiKey, authConfig);\n                }\n                this.settings.app.use(path, auth.authenticate(apiKey, { session: false }));\n                this.settings.logger.debug(\"Authentication Strategy [%s] configured for path [%s]\", key, path);\n            }\n            catch(e) {\n                this.settings.logger.error(\"Error configuring Authentication Strategy [%s] for path [%s]\", key, path, e);\n            }\n        });\n    }\n}\n"]}